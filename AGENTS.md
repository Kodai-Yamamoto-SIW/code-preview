## ルール運用

### 対象範囲

スコープ: このフォルダ配下全体（下位の `AGENTS.md` がある場合は、そちらが優先）。

## このリポジトリについて（@metyatech/code-preview）

このリポジトリは、Docusaurus 等で利用するための **React + TypeScript** 製のコードプレビューライブラリ。

## 基本原則（最優先）

- SOLID を意識し、責務を小さく保つ。
- 重複を避け、共通処理はカスタムフックや小さなユーティリティへ分離する。
- 変数名・関数名は自己説明的にし、読みやすさと保守性を優先する。

## 技術スタック

- 言語: TypeScript（`strict` 前提）
- UI: React（>= 18）
- ビルド: Rollup
- スタイル: CSS Modules（`*.module.css`）
- エディタ: Monaco Editor（`@monaco-editor/react`）

## 実装方針

- クラスコンポーネントは使わず、関数コンポーネントと Hooks で実装する。
- 車輪の再発明を避け、信頼性の高い既存ライブラリで解決できる場合は優先して活用する。
- `useEffect` は必要最小限にし、依存配列を正しく設定する。
- ユーザー入力（HTML/CSS/JS）は信頼できない前提で扱い、プレビュー生成で例外が起きても全体がクラッシュしないように守る（`try/catch` や Error Boundary を検討）。

## コーディング規約

- 命名は具体的で意味のある英語にする（`data`, `temp` のような曖昧名は避ける）。
- 深いネストを避け、ガード節/早期リターンで見通しを保つ。
- 複雑なアルゴリズムや「なぜそうしたか」の理由は、必要最小限のコメントで補足する。

## TypeScript / 型

- `any` は原則禁止。不明な型は `unknown` を使い、型ガードで絞り込む。
- コンポーネント Props は `interface` で定義し、公開 API になるものは JSDoc を付ける。
- `React.FC` は使わず、通常の関数宣言 / 変数宣言でコンポーネントを定義する。

## スタイリング（CSS Modules）

- CSS Modules を使い、スタイルの衝突を避ける。
- クラス名はキャメルケース（例: `.container`, `.activeTab`）を推奨し、JS 側は `styles.container` のように参照する。

## テスト / 品質

- テストは Playwright Component Testing を使用する。
- 挙動が変わる変更（仕様追加/変更/バグ修正/リファクタ等）では、対応する `*.spec.tsx` を追加・更新する。
- Playwright CT では 1 テスト内で `mount()` は 1 回まで（複数シナリオはテストを分割する）。

## 検証

- 変更後は `npm run lint` と `npm test` を実行する。
- 配布物に影響する変更では `npm run build` も実行する。
